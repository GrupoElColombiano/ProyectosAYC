---
import http from '@/services/api'
import { getLangFromUrl, useTranslations } from '@/i18n/utils'

import Layout from '@/layouts/Layout.astro'
import ProyectsSection from '@/components/home/ProyectsSection.astro'
import GridGallery from '@/components/global/gridGallery.astro'
import Shared from '@/components/global/Shared.astro'
import Form from '@/components/global/Form.astro'

const { lang, id } = Astro.params
const getlang = getLangFromUrl(Astro.url)
const t = useTranslations(getlang)

const propertyData = await http(`properties/property/preview?id=${id}&lang=${lang}`) || []
if (propertyData.length === 0) {
 return Astro.redirect(`/${lang}/404`);
}

const seoInfo = {
  title: 'Preview - ' + propertyData?.title,
  description: propertyData?.informacion_general?.descripcion?.slice(0, 150),
  openGraph: {
    basic: {
      title: propertyData?.title,
      type: 'website',
      image: propertyData?.galeria[0]?.url,
    },
    optional: {
      description: propertyData?.informacion_general?.descripcion?.slice(0, 150),
    }
  }
}

---

<Layout seoInfo={seoInfo}>
  <div class="section proyect-section">
    <div class="container xlarge">
      <div class="row align-middle mb-4">
        <div class="col col-mobile-12 col-desktop-6">
          <div class="tags">
            {propertyData?.tags?.map((item) => <span class="tags-item">{item}</span>)}
          </div>
        </div>
        <div class="col col-mobile-12 col-desktop-6 text-mobile-left text-desktop-right">
          <h4 class="text-2xl text-bold text-secundary">
            {t('project.price')} ${propertyData?.informacion_general?.precio}
          </h4>
        </div>
      </div>

      <div class="row">
        <div class="col mb-5">
          <h2 class="text-mobile-1xl text-desktop-2xl text-bold mb-1">
            {propertyData?.title}
          </h2>
          <div>
            <img src="/images/icons/mdi_map-marker.svg" alt="Icon address" />
            {propertyData?.direccion?.zona}
          </div>
        </div>
        <div class="col">
          <Shared />
        </div>
      </div>

      <div>
        <GridGallery images={propertyData?.galeria} />
      </div>

      <div class="row">
        <div class="col col-mobile-12 col-desktop-8">
          <div class="box">
            <div class="box-title">
              <h3 class="text-mobile-xl text-desktop-2xl text-semibold mb-5">
                {t('project.description')}
              </h3>
              <div class="text-color" set:html={propertyData?.informacion_general?.descripcion} />
              {
                 !!propertyData?.informacion_general?.zonas_comunes && (
                  <h3 class="text-mobile-xl text-desktop-2xl text-semibold mb-5">
                    {t('project.areas')}
                  </h3>
                 )
              }
              <div class="text-color" set:html={propertyData?.informacion_general?.zonas_comunes} />
            </div>
          </div>

          <div class="box">
            <div class="box-title">
              <div class="row">
                <div class="col">
                  <h3 class="text-mobile-xl text-desktop-2xl text-semibold mb-5">
                    {t('project.address')}
                  </h3>
                </div>
                <div class="col text-right">
                  <a
                    class="text-semibold text-primary"
                    target="_blank"
                    href={propertyData?.direccion?.link_google_maps}>{t('project.mapLink')}</a
                  >
                </div>
              </div>
              <div class="text-color">
                <div class="row">
                  <div class="col">
                    <b>{t('project.address')}:</b>
                    {propertyData?.direccion?.direccion}
                  </div>
                  <div class="col">
                    <div class="mb-2">
                      <b>{t('project.state')}:</b>
                      {propertyData?.direccion?.zona}
                    </div>

                   <div>
                      <b>{t('project.city')}:</b>
                      {propertyData?.direccion?.ciudad}
                   </div>
                  </div>
                  <div class="col col-narrow">
                    <b> {t('project.country')} :</b>
                    {propertyData?.direccion?.pais}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="box">
            <div class="box-title">
              <h3 class="text-mobile-xl text-desktop-2xl text-semibold mb-5">
                {t('project.features')}
              </h3>
              <ul class="text-color">
                {propertyData?.caracteristicas?.map((item) => <li class="mb-2">{item}</li>)}
              </ul>
            </div>
          </div>

          {
             !!propertyData?.planos?.length && (
              <div class="box">
                <div class="box-title">
                  <h3 class="text-mobile-xl text-desktop-2xl text-semibold mb-5">
                    {t('project.plans')}
                  </h3>
                  <!-- acordion planos  -->
                  <div class="accordion">
                    {
                      propertyData?.planos?.map((item) => (
                        <div class="accordion-item">
                          <div class="accordion-title">
                            <h4 class="text-mobile-lg text-desktop-xl text-semibold">{item?.titulo}</h4>
                            <img src="/images/icons/plus.svg" alt="Icon open modal" width="24" />
                          </div>
                          <div class="accordion-content">
                            <div class="p-4">
                              <img
                                src={item?.image?.url}
                                srcset={item?.image?.srcset}
                                alt={item?.titulo}
                                width="100%"
                              />
                            </div>
                          </div>
                        </div>
                      ))
                    }
                  </div>
                </div>
              </div>
             )
          }

          

          {
            propertyData?.video?.link_video && (
              <div class="box">
                <div class="box-title">
                  <h3 class="text-mobile-xl text-desktop-2xl text-semibold mb-5">Video</h3>
                  <div set:html={propertyData?.video?.link_video} />
                </div>
              </div>
            )
          }

          {
            propertyData?.video?.tour_virtual === 'Si' && (
              <div class="box">
                <div class="box-title">
                  <a href={propertyData?.video?.link_tour_virtual} target="_blank">
                    <h3 class="text-mobile-xl text-desktop-2xl text-semibold mb-5">
                      {t('project.tour')}
                    </h3>
                  </a>
                </div>
              </div>
            )
          }
        </div>
        <div class="col">
          <div class="box p-5">
            <h3 class="text-mobile-xl text-desktop-2xl text-semibold mb-5">
              {t('project.contact')}
            </h3>
            <div class="mb-4">
              <div class="row align-middle">
                <div class="col col-narrow">
                  <img
                    src={propertyData?.sala_de_ventas?.informacion_general?.logo}
                    alt=""
                    width="100"
                  />
                </div>
                <div class="col">
                  <div class="text-sm text-semibold">
                    <img src="/images/icons/profile.svg" alt="" />
                    {propertyData?.sala_de_ventas?.informacion_general?.nombre}
                  </div>
                  <div class="text-sm text-semibold">
                    <img src="/images/icons/cell.svg" alt="" />
                    {propertyData?.sala_de_ventas?.informacion_general?.celular}
                  </div>
                  <div class="text-sm text-semibold">
                    <img src="/images/icons/cell.svg" alt="" />
                    {propertyData?.sala_de_ventas?.informacion_general?.telefono_fijo}
                  </div>
                  <div class="text-sm text-semibold">
                    <img src="/images/icons/email.svg" alt="" />
                    {propertyData?.sala_de_ventas?.informacion_general?.email}
                  </div>
                </div>
              </div>
            </div>
            <Form proyect={propertyData?.title} />
          </div>
        </div>
      </div>
    </div>
  </div>
  <ProyectsSection />
</Layout>
