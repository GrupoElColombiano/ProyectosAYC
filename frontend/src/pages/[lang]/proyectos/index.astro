---
import Layout from '@/layouts/Layout.astro'
import Topbar from '@/components/layout/Topbar.astro'
import PropertyCardCarousel from '@/components/global/PropertyCardCarousel.astro'
import ArticleCard from '@/components/global/ArticleCard.astro'
import http from '@/services/api'
import { getLangFromUrl, useTranslations } from '@/i18n/utils'

const { lang } = Astro.params
const getLang = getLangFromUrl(Astro.url)
const t = useTranslations(getLang)
const properties = await http(
  `properties/categories?properties_limit=4&location_limit=10&lang=${lang}`
)
const articleList = await http(`articles?limit=2&lang=${lang}`)
const advertising = await http(`advertising`)

const seoInfo = {
  title: 'Zonas proyectos',
  description: `El compromiso de locales y extranjeros con la región ha impulsado su desarrollo económico, con especial en el sector inmobiliario.`
}
---

<Layout seoInfo={seoInfo}>
  <Topbar title="Inicio > Zonas proyectos" />

  <div class="section">
    <div class="container xlarge">
      <div class="row">
        <div class="col col-mobile-12 col-desktop-8">
          {
            properties?.map((category) => (
              <div class="mb-mobile-6">
                <h2 class="text-mobile-2xl text-desktop-3xl text-semibold bullet-decoration mb-5">
                  {category.localizacion}
                </h2>
                <div class="row mb-6">
                  {category?.propiedades?.map((property) => (
                    <div class="col col-mobile-12 col-desktop-6">
                      <PropertyCardCarousel
                        name={property?.title}
                        images={property?.galeria}
                        price={property?.informacion_general?.precio}
                        area={property?.informacion_general?.areas_disponibles}
                        rooms={property?.informacion_general?.n_habitaciones}
                        bathrooms={property?.informacion_general?.n_banos}
                        location={property?.informacion_general?.zona}
                        link={`/${lang}/proyectos/${category.slug}/${property.slug}`}
                      />
                    </div>
                  ))}
                </div>
                <a href={`/${lang}/proyectos/${category.slug}`} class="button mx-auto mt-6">
                  {t('button.see')}
                </a>
              </div>
            ))
          }
        </div>
        <div class="col col-mobile-12 col-desktop-3">
          <h3 class="text-mobile-lg text-desktop-xl text-bold mb-4">
            {t('project.moreArticles')}
          </h3>
          {
            articleList?.map((article) => (
              <div class="mb-4">
                <ArticleCard
                  image={article?.image?.url}
                  image_srcset={article?.image?.srcset}
                  subtitle={article?.categories[0]}
                  title={article?.title}
                  href={`/${lang}/articulos/${article?.slug}`}
                />
              </div>
            ))
          }

          {
            advertising?.map((ad) => (
              <div class="mb-4">
                <a href={ad?.link} target="_blank">
                  <img src={ad?.image?.url} srcset={ad?.image?.srcset} />
                </a>
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</Layout>
